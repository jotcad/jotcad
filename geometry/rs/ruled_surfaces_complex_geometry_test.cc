<<<<<<< HEAD
#include <cassert>
#include <iostream>

=======
>>>>>>> main
#include "ruled_surfaces_join_strategy_naive.h"
#include "ruled_surfaces_objective_min_area.h"
#include "ruled_surfaces_sa_stopping_rules.h"
#include "ruled_surfaces_strategy_linear_slg.h"
#include "ruled_surfaces_strategy_seam_search_sa.h"
#include "ruled_surfaces_test_utils.h"
<<<<<<< HEAD
=======
#include <cassert>
#include <iostream>
>>>>>>> main

namespace geometry {
namespace test {

void RuleComplexAsymmetricLoops() {
  auto [p, q] = test::generate_complex_asymmetric_loops(20, 25);
  assert(p.front() == p.back());
  assert(q.front() == q.back());
  Mesh mesh;
  PolygonalChain p_result, q_result;
  SolutionStats stats;
  assert((RuleLoopsSA<LinearSearchSlg<MinArea>, ConvergenceStoppingRule>(
<<<<<<< HEAD
             p, q,
             {.seed = 0, .stopping_rule = ConvergenceStoppingRule(200, 10000)},
             &mesh, &p_result, &q_result, &stats)) ==
         SolutionStats::PATH_LIMIT_EXCEEDED);
=======
                p, q,
                {.seed = 0, .stopping_rule = ConvergenceStoppingRule(200, 10000)},
                &mesh, &p_result, &q_result, &stats)) ==
            SolutionStats::PATH_LIMIT_EXCEEDED);
>>>>>>> main
  std::cout << "OBJ String for Ruled Complex Asymmetric Loops:\n"
            << test::GetMeshAsObjString(mesh, {p_result, q_result})
            << std::endl;
  assert(test::GetMeshAsObjString(mesh, {p_result, q_result}) == R"OBJ(
v 1.050000 0.000000 0.000000
v 1.160000 0.000000 0.500000
v 1.021093 0.350542 0.061421
v 1.129440 0.302632 0.584853
v 0.960666 0.554641 0.620000
v 0.822489 0.640169 0.096940
v 0.777817 0.777817 0.584853
v 0.562664 0.861221 0.091577
v 0.545359 0.944589 0.500000
v 0.266769 0.995597 0.415147
v 0.239034 0.943923 0.047595
v 0.000000 1.040000 0.380000
v -0.072916 0.879959 -0.016459
v -0.302632 1.129440 0.415147
v -0.370988 0.845768 -0.073572
v -0.614641 1.064589 0.500000
v -0.737403 0.801033 -0.099658
v -0.777817 0.777817 0.584853
v -1.001822 0.542159 -0.083717
v -0.840666 0.485359 0.620000
v -0.995597 0.266769 0.584853
v -0.999905 0.166855 -0.032470
v -1.160000 0.000000 0.500000
v -0.906013 -0.151187 0.032470
v -1.129440 -0.302632 0.415147
v -0.826528 -0.447295 0.083717
v -0.960666 -0.554641 0.380000
v -0.654204 -0.710655 0.099658
v -0.777817 -0.777817 0.415147
v -0.545359 -0.944589 0.500000
v -0.397074 -0.905239 0.073572
v -0.266769 -0.995597 0.584853
v -0.088926 -1.073177 0.016459
v -0.000000 -1.040000 0.620000
v 0.302632 -1.129440 0.584853
v 0.275156 -1.086565 -0.047595
v 0.614641 -1.064589 0.500000
v 0.544659 -0.833663 -0.091577
v 0.777817 -0.777817 0.415147
v 0.677954 -0.527673 -0.096940
v 0.840666 -0.485359 0.380000
v 0.862731 -0.296176 -0.061421
v 0.995597 -0.266769 0.415147
f 1 2 3
f 3 2 4
f 3 4 5
f 3 5 6
f 6 5 7
f 6 7 8
f 8 7 9
f 8 9 10
f 8 10 11
f 11 10 12
f 11 12 13
f 13 12 14
f 13 14 15
f 15 14 16
f 15 16 17
f 17 16 18
f 17 18 19
f 19 18 20
f 19 20 21
f 19 21 22
f 22 21 23
f 22 23 24
f 24 23 25
f 24 25 26
f 26 25 27
f 26 27 28
f 28 27 29
f 28 29 30
f 28 30 31
f 31 30 32
f 31 32 33
f 33 32 34
f 33 34 35
f 33 35 36
f 36 35 37
f 36 37 38
f 38 37 39
f 38 39 40
f 40 39 41
f 40 41 42
f 42 41 43
f 42 43 1
f 1 43 2
l 1 2
l 1 3 6 8 11 13 15 17 19 22 24 26 28 31 33 36 38 40 42 1
f 1 3 6 8 11 13 15 17 19 22 24 26 28 31 33 36 38 40 42
l 2 4 5 7 9 10 12 14 16 18 20 21 23 25 27 29 30 32 34 35 37 39 41 43 2
f 2 4 5 7 9 10 12 14 16 18 20 21 23 25 27 29 30 32 34 35 37 39 41 43
)OBJ");
}

void RuleRotatedClosedCrescents3Geometry() {
  auto [p, q] = test::CreateIdeallyRotatedClosedCrescents3Geometry();
  Mesh mesh;
  PolygonalChain p_result, q_result;
  SolutionStats stats;
  assert((RuleLoopsSA<LinearSearchSlg<MinArea>, ConvergenceStoppingRule>(
<<<<<<< HEAD
             p, q,
             {.seed = 0, .stopping_rule = ConvergenceStoppingRule(200, 10000)},
             &mesh, &p_result, &q_result, &stats)) ==
         SolutionStats::PATH_LIMIT_EXCEEDED);
=======
                p, q,
                {.seed = 0, .stopping_rule = ConvergenceStoppingRule(200, 10000)},
                &mesh, &p_result, &q_result, &stats)) ==
            SolutionStats::PATH_LIMIT_EXCEEDED);
>>>>>>> main
  std::cout << "OBJ String for Rotated Closed Crescents 3 Geometry:\n"
            << test::GetMeshAsObjString(mesh, {p_result, q_result})
            << std::endl;
  assert(test::GetMeshAsObjString(mesh, {p_result, q_result}) == R"OBJ(
v -0.500000 0.866025 0.000000
v 0.500000 0.866025 1.000000
v -0.766044 0.642788 1.000000
v 0.069361 0.375697 0.000000
v 0.069361 -0.375697 0.000000
v -0.766044 -0.642788 1.000000
v -0.500000 -0.866025 0.000000
v 0.500000 -0.866025 1.000000
v 0.766044 -0.642788 0.000000
v -0.069361 -0.375697 1.000000
v -0.069361 0.375697 1.000000
v 0.766044 0.642788 0.000000
f 1 2 3
f 1 3 4
f 4 3 5
f 5 3 6
f 5 6 7
f 7 6 8
f 7 8 9
f 9 8 10
f 9 10 11
f 9 11 12
f 12 11 2
f 12 2 1
l 1 2
l 1 4 5 7 9 12 1
f 1 4 5 7 9 12
l 2 3 6 8 10 11 2
f 2 3 6 8 10 11
)OBJ");
}

void RuleHighlyIrregularLoops() {
  auto [p, q] = test::CreateHighlyIrregularLoopsGeometry();
  assert(p.front() == p.back());
  assert(q.front() == q.back());
  Mesh mesh;
  PolygonalChain p_result, q_result;
  SolutionStats stats;
  auto status = RuleLoopsSA<LinearSearchSlg<MinArea>, ConvergenceStoppingRule>(
      p, q, {.seed = 0, .stopping_rule = ConvergenceStoppingRule(200, 10000)},
      &mesh, &p_result, &q_result, &stats);
  assert(status == SolutionStats::PATH_LIMIT_EXCEEDED ||
<<<<<<< HEAD
         status == SolutionStats::NO_SOLUTION_FOUND);
=======
              status == SolutionStats::NO_SOLUTION_FOUND);
>>>>>>> main
  std::cout << "OBJ String for Highly Irregular Loops:\n"
            << test::GetMeshAsObjString(mesh, {p_result, q_result})
            << std::endl;
  assert(test::GetMeshAsObjString(mesh, {p_result, q_result}) == R"OBJ(
v 1.047943 0.000000 0.000000
v 1.146300 0.000000 0.800000
v 1.228942 0.158455 0.059811
v 1.094157 0.286922 0.095867
v 1.303026 0.139292 0.867831
v 1.224863 0.264901 0.899681
v 1.055570 0.349200 0.878655
v 0.969012 0.439702 0.815906
v 0.955889 0.563252 0.744720
v 0.942013 0.381379 0.093847
v 0.871894 0.647766 0.702857
v 0.863124 0.486102 0.054553
v 0.660053 0.609333 0.712524
v 0.689733 0.514761 -0.006407
v 0.542769 0.525643 -0.064823
v 0.599348 0.751559 -0.097493
v 0.648954 1.070517 -0.091441
v 0.491960 1.111347 -0.049072
v 0.280934 0.946561 0.012788
v 0.145544 0.900243 0.069568
v 0.439585 0.502374 0.768592
v 0.353089 0.502679 0.841321
v 0.390230 0.704486 0.892131
v 0.416726 0.987426 0.894070
v 0.345709 1.146513 0.846109
v 0.213664 1.133173 0.773690
v 0.087560 1.093936 0.715227
v 0.028996 0.904203 0.098718
v -0.030728 1.153903 0.701732
v -0.079295 0.821971 0.088660
v -0.201109 0.881114 0.043388
v -0.165368 1.234915 0.740363
v -0.282454 1.156147 0.810629
v -0.319752 0.886664 0.875257
v -0.298231 0.613305 0.899965
v -0.332111 0.530789 0.871646
v -0.489969 0.624082 0.805322
v -0.693656 0.712374 0.736176
v -0.411914 1.119305 -0.019116
v -0.594008 1.138602 -0.074028
v -0.591174 0.847492 -0.099538
v -0.560861 0.617571 -0.085514
v -0.665237 0.566324 -0.037527
v -0.762186 0.496128 0.025365
v -0.815035 0.675719 0.700885
v -0.827746 0.398621 0.078183
v -0.852633 0.565616 0.718170
v -1.049820 0.348564 0.099949
v -0.935428 0.486074 0.778862
v -1.127462 0.440847 0.850767
v -1.297545 0.353854 0.895742
v -1.255350 0.202255 0.889931
v -0.998026 0.053193 0.836416
v -0.742618 -0.039580 0.763584
v -0.686124 -0.110545 0.710069
v -1.262184 0.245810 0.082017
v -1.117210 0.071727 0.031511
v -0.814349 -0.052283 -0.031511
v -0.791490 -0.215848 0.704258
v -0.776361 -0.151196 -0.082017
v -0.895465 -0.297315 -0.099949
v -0.896358 -0.431663 -0.078183
v -0.886236 -0.576876 -0.025365
v -0.865377 -0.338370 0.749233
v -0.928279 -0.790255 0.037527
v -0.794029 -0.874314 0.085514
v -0.813079 -0.422498 0.821138
v -0.735901 -0.488179 0.881830
v -0.761925 -0.631687 0.899115
v -0.855469 -0.878554 0.863824
v -0.859269 -1.094466 0.794678
v -0.697251 -1.114367 0.728354
v -0.461404 -0.948866 0.700035
v -0.498315 -0.714372 0.099538
v -0.284970 -0.790214 0.724743
v -0.332490 -0.637321 0.074028
v -0.311659 -0.846879 0.019116
v -0.239185 -1.047940 -0.043388
v -0.104013 -1.078207 -0.088660
v 0.036351 -1.133562 -0.098718
v 0.186990 -1.156596 -0.069568
v 0.272512 -0.918185 -0.012788
v -0.192468 -0.787813 0.789371
v -0.117448 -0.877062 0.859637
v -0.023647 -0.887983 0.898268
v 0.063223 -0.789881 0.884773
v 0.139912 -0.742027 0.826310
v 0.264641 -0.877661 0.753891
v 0.288052 -0.650716 0.049072
v 0.423538 -0.698670 0.091441
v 0.467438 -1.107585 0.705930
v 0.684906 -0.858845 0.097493
v 0.668205 -1.206315 0.707869
v 0.752463 -1.071252 0.758679
v 0.721745 -0.824836 0.831408
v 0.836203 -0.809817 0.064823
v 0.700498 -0.646670 0.887476
v 0.767895 -0.570501 0.897143
v 0.842906 -0.496678 0.855280
v 0.799592 -0.362825 0.784094
v 0.877551 -0.654933 0.006407
v 0.669828 -0.221590 0.721345
v 0.956954 -0.538947 -0.054553
v 0.937108 -0.379393 -0.093847
v 0.749394 -0.196514 -0.095867
v 0.745506 -0.096122 -0.059811
v 0.645208 -0.139539 0.700319
v 0.845462 -0.090379 0.732169
f 1 2 3
f 3 2 4
f 4 2 5
f 4 5 6
f 4 6 7
f 4 7 8
f 4 8 9
f 4 9 10
f 10 9 11
f 10 11 12
f 12 11 13
f 12 13 14
f 14 13 15
f 15 13 16
f 16 13 17
f 17 13 18
f 18 13 19
f 19 13 20
f 20 13 21
f 20 21 22
f 20 22 23
f 20 23 24
f 20 24 25
f 20 25 26
f 20 26 27
f 20 27 28
f 28 27 29
f 28 29 30
f 30 29 31
f 31 29 32
f 31 32 33
f 31 33 34
f 31 34 35
f 31 35 36
f 31 36 37
f 31 37 38
f 31 38 39
f 39 38 40
f 40 38 41
f 41 38 42
f 42 38 43
f 43 38 44
f 44 38 45
f 44 45 46
f 46 45 47
f 46 47 48
f 48 47 49
f 48 49 50
f 48 50 51
f 48 51 52
f 48 52 53
f 48 53 54
f 48 54 55
f 48 55 56
f 56 55 57
f 57 55 58
f 58 55 59
f 58 59 60
f 60 59 61
f 61 59 62
f 62 59 63
f 63 59 64
f 63 64 65
f 65 64 66
f 66 64 67
f 66 67 68
f 66 68 69
f 66 69 70
f 66 70 71
f 66 71 72
f 66 72 73
f 66 73 74
f 74 73 75
f 74 75 76
f 76 75 77
f 77 75 78
f 78 75 79
f 79 75 80
f 80 75 81
f 81 75 82
f 82 75 83
f 82 83 84
f 82 84 85
f 82 85 86
f 82 86 87
f 82 87 88
f 82 88 89
f 89 88 90
f 90 88 91
f 90 91 92
f 92 91 93
f 92 93 94
f 92 94 95
f 92 95 96
f 96 95 97
f 96 97 98
f 96 98 99
f 96 99 100
f 96 100 101
f 101 100 102
f 101 102 103
f 103 102 104
f 104 102 105
f 105 102 106
f 106 102 107
f 106 107 108
f 106 108 1
f 1 108 2
l 1 2
l 1 3 4 10 12 14 15 16 17 18 19 20 28 30 31 39 40 41 42 43 44 46 48 56 57 58 60 61 62 63 65 66 74 76 77 78 79 80 81 82 89 90 92 96 101 103 104 105 106 1
f 1 3 4 10 12 14 15 16 17 18 19 20 28 30 31 39 40 41 42 43 44 46 48 56 57 58 60 61 62 63 65 66 74 76 77 78 79 80 81 82 89 90 92 96 101 103 104 105 106
l 2 5 6 7 8 9 11 13 21 22 23 24 25 26 27 29 32 33 34 35 36 37 38 45 47 49 50 51 52 53 54 55 59 64 67 68 69 70 71 72 73 75 83 84 85 86 87 88 91 93 94 95 97 98 99 100 102 107 108 2
f 2 5 6 7 8 9 11 13 21 22 23 24 25 26 27 29 32 33 34 35 36 37 38 45 47 49 50 51 52 53 54 55 59 64 67 68 69 70 71 72 73 75 83 84 85 86 87 88 91 93 94 95 97 98 99 100 102 107 108
)OBJ");
}

}  // namespace test
}  // namespace geometry

int main(int argc, char** argv) {
  geometry::test::RuleComplexAsymmetricLoops();
  geometry::test::RuleRotatedClosedCrescents3Geometry();
  geometry::test::RuleHighlyIrregularLoops();
  return 0;
}
